[supervisord]
nodaemon=true
user=root
# Supervisord reste en root pour pouvoir gérer nginx et les logs

[program:nginx]
command=/bin/sh -c "mkdir -p /var/log/nginx /var/lib/nginx/tmp /run/nginx && nginx -g 'daemon off;'"
autostart=true
autorestart=true
stderr_logfile=/var/log/nginx/error.log
stdout_logfile=/var/log/nginx/access.log

[program:backend]
command=/app/venv/bin/run_api
directory=/app
autostart=true
autorestart=true
stderr_logfile=/var/log/backend_error.log
stdout_logfile=/var/log/backend_access.log
environment=API_HOST="0.0.0.0",API_PORT="5000",PYTHONPATH="/app",PYTHONUNBUFFERED="1"
user=appuser
# Logs backend accessibles via ./logs/backend_*.log sur l'hôte

[program:frontend]
command=node server.js
directory=/app
autostart=true
autorestart=true
stderr_logfile=/var/log/frontend_error.log
stdout_logfile=/var/log/frontend_access.log
environment=PORT="3000",NODE_ENV="production",HOSTNAME="0.0.0.0"
user=appuser
# Logs frontend accessibles via ./logs/frontend_*.log sur l'hôte